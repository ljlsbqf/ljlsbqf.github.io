(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{530:function(s,t,n){"use strict";n.r(t);var a=n(31),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h3",{attrs:{id:"官网"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#官网"}},[s._v("#")]),s._v(" 官网")]),s._v(" "),n("p",[s._v("https://www.elastic.co/guide/index.html\nhttps://hub.docker.com/")]),s._v(" "),n("h3",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),n("p",[s._v("1.dockerhub官网查询镜像安装:")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker pull elasticsearch:8.2.2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("3.创建本机挂载目录")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sudo mkdir -p /opt/elasticsearch/config\nsudo mkdir -p /opt/elasticsearch/data\nsudo mkdir -p /opt/elasticsearch/plugins\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("4.容器启动")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(' --net elknet --ip 127.0.0.1 \\\nsudo docker run --name elasticsearch -p 9200:9200  -p 9300:9300 \\\n -e "discovery.type=single-node" \\\n -e ES_JAVA_OPTS="-Xms84m -Xmx512m" \\\n -v /opt/elasticsearch/config:/usr/share/elasticsearch/config \\\n -v /opt/elasticsearch/data:/usr/share/elasticsearch/data \\\n -v /opt/elasticsearch/plugins:/usr/share/elasticsearch/plugins \\\n -d elasticsearch:8.2.2\n \n 若报错，可先不挂载目录启动；启动成功后，再将容器内目录复制到宿主机，rm容器，重新新建docker容器，挂载目录\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("说明")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('-p 端口映射\n-e discovery.type=single-node 单点模式启动\n-e ES_JAVA_OPTS="-Xms84m -Xmx512m"：设置启动占用的内存范围,es内存使用率高，建议配置\n-v 目录挂载\n-d 后台运行\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("6.验证\nes默认开启https访问")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("curl https://127.0.0.1:9200\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("7.开启账号密码\nes8 已经不建议在es中设置账号密码，建议使用kibana设置访问端口\n参考 https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-passwords.html")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("进入docker镜像，修改默认的elastic用户密码:\n./elasticsearch-reset-password -u elastic -i\n修改为:elasticdev\n访问测试:\ncurl --cacert /opt/elasticsearch/config/certs/http_ca.crt -u elastic https://localhost:9200\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"es字段说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#es字段说明"}},[s._v("#")]),s._v(" es字段说明")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("参考：\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html\nhttps://www.jianshu.com/p/9af735d634a2\n1. text\ntext字段会被分词，对于text类型的字段你可能无法通过指定文本精确的检索到。另外需要注意的是，text类型的字段不能直接用于排序、聚合操作。\n这种类型的字符串也称做analyzed字符串。\n2.keyword\nkeyword类型适用于结构化的字段，比如手机号、商品id、用户id等，默认最大长度为256。keyword类型的字段内容不会被分词器分析、拆分，\n而是根据原始文本直接生成倒排索引，所以keyword类型的字段可以直接通过原始文本精确的检索到。keyword类型的字段可用于过滤、排序、聚合操作。\n这种字符串称做not-analyzed字符串。\n3.日期类型\nES 中的date类型默认支持如下两种格式：\nstrict_date_optional_time，表示 yyyy-MM-dd'T'HH:mm:ss.SSSSSSZ 或者 yyyy-MM-dd 格式的日期\nepoch_millis，表示从 1970.1.1 零点到现在的毫秒数\n\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h3",{attrs:{id:"es中match-term使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#es中match-term使用"}},[s._v("#")]),s._v(" es中match term使用")]),s._v(" "),n("p",[s._v("参考：https://blog.csdn.net/z8756413/article/details/85068970")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("term:是代表完全匹配，即不进行分词器分析，文档中必须包含整个搜索的词汇.\nmatch和term的区别是,match查询的时候,elasticsearch会根据你给定的字段提供合适的分析器,\n而term查询不会有分析器分析的过程，match查询相当于模糊匹配,只包含其中一部分关键词就行\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"es组合查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#es组合查询"}},[s._v("#")]),s._v(" es组合查询")]),s._v(" "),n("p",[s._v("参考：https://juejin.cn/post/6936487066272432142")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("bool query 支持多种查询子句类型，分别是：\nmust：其查询子句必须全部被满足，逻辑相当于 and ，并且会计算分数。\nfilter：与 must 作用一样，但是不会计算分数。在 filter context  下的查询子句不会计算分数且会被缓存。\nshould：其查询子句应该被满足，也就是不一定都满足，逻辑相当于 or。\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"es相关查询功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#es相关查询功能"}},[s._v("#")]),s._v(" es相关查询功能")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('参考:\nhttps://blog.csdn.net/weixin_39626369/article/details/111575946\nhttps://www.jianshu.com/p/81a2c3032079\n删除索引:\ncurl --cacert /opt/elasticsearch/config/certs/http_ca.crt -u elastic https://localhost:9200/student -X DELETE\n\n\n\n\n创建索引\ncurl --cacert /opt/elasticsearch/config/certs/http_ca.crt -u elastic https://localhost:9200/student -X POST -H \'Content-Type:application/json;charset=utf-8\' -D \'\n{\n\t"mappings": {\n\t\t"properties": {\n\t\t\t"num": {\n\t\t\t\t"type": "integer",\n\t\t\t\t"index": true\n\t\t\t},\n\t\t\t"sex": {\n\t\t\t\t"type": "boolean",\n\t\t\t\t"index": true\n\t\t\t},\n\t\t\t"grade": {\n\t\t\t\t"type": "integer",\n\t\t\t\t"index": true\n\t\t\t},\n\t\t\t"schoolName": {\n\t\t\t\t"type": "text",\n\t\t\t\t"fields": {\n\t\t\t\t\t"keyword": {\n\t\t\t\t\t\t"type": "keyword",\n\t\t\t\t\t\t"ignore_above": 256\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t"userName": {\n\t\t\t\t"type": "object",\n\t\t\t\t"properties": {\n\t\t\t\t\t"last": {\n\t\t\t\t\t\t"type": "text",\n\t\t\t\t\t\t"fields": {\n\t\t\t\t\t\t\t"keyword": {\n\t\t\t\t\t\t\t\t"type": "keyword",\n\t\t\t\t\t\t\t\t"ignore_above": 256\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t"first": {\n\t\t\t\t\t\t"type": "text",\n\t\t\t\t\t\t"fields": {\n\t\t\t\t\t\t\t"keyword": {\n\t\t\t\t\t\t\t\t"type": "keyword",\n\t\t\t\t\t\t\t\t"ignore_above": 256\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t"settings": {\n\t\t"number_of_shards": "1",\n\t\t"number_of_replicas": "1"\n\t}\n}\'\n\n查看es结构：\ncurl --cacert /opt/elasticsearch/config/certs/http_ca.crt -u elastic https://localhost:9200/student\n\ncurl --cacert /opt/elasticsearch/config/certs/http_ca.crt -u elastic https://localhost:9200/_cat\n\n查询语句：\ncurl --cacert /opt/elasticsearch/config/certs/http_ca.crt -u elastic https://localhost:9200/student/_search -H \'Content-Type:application/json;charset=utf-8\'  -X POST -d \'\n{       "query": {\n            "match": {\n                "schoolName": {\n                    "query": "七中"\n                }\n            }\n        }\n}\'\n\n更新es索引mapping，新增字段\n参考:https://blog.csdn.net/qq_41878532/article/details/111562255\ncurl --cacert /opt/elasticsearch/config/certs/http_ca.crt -u elastic https://localhost:9200/student/_mapping -H \'Content-Type:application/json;charset=utf-8\'  -X PUT -d \'\n{\n  "properties":{\n    "joinDate" : {\n        "type": "date",\n        "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"\n      }\n  }\n}\'\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);