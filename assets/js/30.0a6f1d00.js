(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{535:function(s,e,n){"use strict";n.r(e);var t=n(30),a=Object(t.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h3",{attrs:{id:"安装redis7"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装redis7"}},[s._v("#")]),s._v(" 安装redis7")]),s._v(" "),n("p",[s._v("github:https://github.com/redis/redis")]),s._v(" "),n("p",[s._v("官网:https://redis.io/docs/")]),s._v(" "),n("p",[s._v("1.dockerhub官网查询镜像安装:")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker pull redis:7.0.2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("3.创建本机挂载目录")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sudo mkdir -p /opt/redis/data\nsudo mkdir -p /opt/elasticsearch/data\nsudo mkdir -p /opt/elasticsearch/plugins\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("4.容器启动")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sudo docker run --name redis -p 6379:6379 \\\n -v /opt/redis/redis.conf:/etc/redis.conf \\\n -v /opt/redis/data:/data \\\n -d redis:7.0.2 redis-server /etc/redis.conf\n\nredis镜像内是没有redis.conf文件的，需要用户自己到github上下载映射进去\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("参数说明:")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("--privileged=true：容器内的root拥有真正root权限，否则容器内root只是外部普通用户权限\n-v /docker/redis/conf/redis.conf:/etc/redis/redis.conf：映射配置文件\n-v /docker/redis/data:/data：映射数据目录\nredis-server /etc/redis/redis.conf：指定配置文件启动redis-server进程\n--appendonly yes：开启数据持久化\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("5.ca证书生成\n下载ca生成脚本:https://fossies.org/linux/redis/utils/gen-test-certs.sh\n或下载redis源码获取")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#!/bin/bash\n\n# Generate some test certificates which are used by the regression test suite:\n#\n#   tests/tls/ca.{crt,key}          Self signed CA certificate.\n#   tests/tls/redis.{crt,key}       A certificate with no key usage/policy restrictions.\n#   tests/tls/client.{crt,key}      A certificate restricted for SSL client usage.\n#   tests/tls/server.{crt,key}      A certificate restricted for SSL server usage.\n#   tests/tls/redis.dh              DH Params file.\n\ngenerate_cert() {\n    local name=$1\n    local cn="$2"\n    local opts="$3"\n\n    local keyfile=/opt/redis/tls/${name}.key\n    local certfile=/opt/redis/tls/${name}.crt\n\n    [ -f $keyfile ] || openssl genrsa -out $keyfile 2048\n    openssl req \\\n        -new -sha256 \\\n        -subj "/O=Redis Test/CN=$cn" \\\n        -key $keyfile | \\\n        openssl x509 \\\n            -req -sha256 \\\n            -CA /opt/redis/tls/ca.crt \\\n            -CAkey /opt/redis/tls/ca.key \\\n            -CAserial /opt/redis/tls/ca.txt \\\n            -CAcreateserial \\\n            -days 365 \\\n            $opts \\\n            -out $certfile\n}\n\nmkdir -p /opt/redis/tls\n[ -f /opt/redis/tls/ca.key ] || openssl genrsa -out /opt/redis/tls/ca.key 4096\nopenssl req \\\n    -x509 -new -nodes -sha256 \\\n    -key /opt/redis/tls/ca.key \\\n    -days 3650 \\\n    -subj \'/O=Redis Test/CN=Certificate Authority\' \\\n    -out /opt/redis/tls/ca.crt\n\ncat > /opt/redis/tls/openssl.cnf <<_END_\n[ server_cert ]\nkeyUsage = digitalSignature, keyEncipherment\nnsCertType = server\n\n[ client_cert ]\nkeyUsage = digitalSignature, keyEncipherment\nnsCertType = client\n_END_\n\ngenerate_cert server "Server-only" "-extfile /opt/redis/tls/openssl.cnf -extensions server_cert"\ngenerate_cert client "Client-only" "-extfile /opt/redis/tls/openssl.cnf -extensions client_cert"\ngenerate_cert redis "Generic-cert"\n\n[ -f /opt/redis/tls/redis.dh ] || openssl dhparam -out /opt/redis/tls/redis.dh 2048\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br")])]),n("ol",{attrs:{start:"6"}},[n("li",[s._v("redis 开启tls")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("修改配置文件redis.conf\n--tls-port 6379 --port 0 \\\n--tls-cert-file /opt/redis/redis-7.0.2/tests/tls/redis.crt \\\n--tls-key-file /opt/redis/redis-7.0.2/tests/tls/redis.key \\\n--tls-ca-cert-file /opt/redis/redis-7.0.2/tests/tls/ca.crt\n  \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("ol",{attrs:{start:"7"}},[n("li",[s._v("登录校验")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("启动：\n./src/redis-server \\\n--tls-port 6379 --port 0 \\\n--tls-cert-file /opt/redis/redis-7.0.2/tests/tls/redis.crt \\\n--tls-key-file /opt/redis/redis-7.0.2/tests/tls/redis.key \\\n--tls-ca-cert-file /opt/redis/redis-7.0.2/tests/tls/ca.crt\n\n./src/redis-cli -a foobared --tls \\\n--cert ./tests/tls/redis.crt \\\n--key ./tests/tls/redis.key \\\n--cacert ./tests/tls/ca.crt\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("6.配置redis tls访问\n参考:https://redis.io/docs/manual/security/encryption/\nhttps://blog.csdn.net/shuux666/article/details/123838193")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])}),[],!1,null,null,null);e.default=a.exports}}]);